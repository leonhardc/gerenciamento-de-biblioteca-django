<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./../../templates/static/bootstrap/css/bootstrap.css"> 
    <title>Document</title>
    <style>
        .error {
            color: red; 
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Formulario de inserção de aluno na base de dados -->
        <h4 class="text-center mb-4">Inserir Aluno</h4>
        <form action="" method="POST" class="px-4">
            <div class="row mb-2">
                <div class="col">
                    <label for="nome" class="form-label font-weight-bold" id="label-nome">Nome</label>            
                    <input required type="text" id="nome" name="nome" class="form-control" placeholder="Digite o nome do Aluno">
                    <span class="error" id="span-error-nome"></span>
                </div>                
                <div class="col">
                    <label for="sobrenome" class="form-label font-weight-bold" id="label-sobrenome">Sobrenome</label>
                    <input required type="text" id="sobrenome" name="sobrenome" class="form-control" placeholder="Digite o sobrenome do Aluno">
                    <span class="error" id="span-error-sobrenome"></span>
                </div>
            </div>
            <div class="row mb-2">
                <div class="col">
                    <div class="mb-4">
                        <label for="email" class="form-label font-weight-bold" id="label-email">Email</label>
                        <input required type="text" id="email" name="email" class="form-control" placeholder="Digite o email do Aluno">
                        <span class="error" id="span-error-email"></span>
                    </div>
                    
                    <div class="row">
                        <div class="col">
                            <label for="ingresso" class="form-label" id="label-data-ingresso">Data de Ingresso no Curso</label>
                            <input required type="date" id="ingresso" name="data-ingresso" class="form-control">
                            <span class="error" id="span-error-data-ingresso"></span>
                        </div>
                        <div class="col">
                            <label for="conclusao" class="form-label" id="label-data-conclusao">Data de Conclusão prevista</label>
                            <input required type="date" id="conclusao" name="data-conclusao" class="form-control">
                            <span class="error" id="span-error-data-conclusao"></span>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="mb-4">
                        <label for="senha" class="form-label" id="label-senha">Senha</label>
                        <input required type="password" id="senha" name="senha" class="form-control" placeholder="Digite a senha do Aluno">
                        <span class="error" id="span-error-senha"></span>
                    </div>
                    <div class="mb-4">
                        <label for="senha-confirm" class="form-label" id="label-senha-confirm">Confirmar Senha</label>
                        <input required type="password" id="senha-confirm" name="senha-confirm" class="form-control" placeholder="Confirme a senha do Aluno">
                        <span class="error" id="span-error-senha-confirm"></span>
                    </div>
                </div>
            </div>
            
            <div class="row mb-4">
                <div class="col">
                    <label for="imagem" class="form-label">Imagem de Perfil</label>
                    <input type="file" id="imagem" name="imagem" class="form-control" accept="image/png, image/jpeg">
                </div>
                <div class="col">
                    <label for="telefone" class="form-label" id="label-telefone">Telefone/Celular</label>
                    <input required type="text" id="telefone" name="telefone" class="form-control">
                    <span class="error" id="span-error-telefone"></span>
                </div>
            </div>

            <div class="d-flex justify-content-center">
                <button class="btn btn-primary">Adicionar Aluno</button>
            </div>
        </form>
        <script>
            // Inserir validação dos campos do formulário
            var submitButton = document.querySelector("#submit")
            // Validação do campo de nome
            function validarNome(){
                const nome = document.querySelector('#nome')
                var erroNome = document.querySelector("#span-error-nome")
                var labelNome = document.querySelector("#label-nome")
                if (/[@!#$%^&*()/\\0-9]/.test(nome.value)){
                    labelNome.style.color = "red"
                    nome.style.borderColor = "red"
                    nome.style.color = "red"
                    erroNome.textContent = "O nome do aluno não pode conter números ou caracteres especiais."
                    submitButton.disabled = true
                }
                else {
                    labelNome.style.color = "black"
                    nome.style.border = "var(--bs-border-width) solid var(--bs-border-color)"
                    nome.style.borderColor = "black"
                    erroNome.textContent = ""
                    submitButton.disabled = false
                }
            }

            // Validação do campo de sobrenome
            function validarSobrenome(){
                var sobrenome = document.querySelector('#sobrenome')
                var erroSobrenome = document.querySelector("#span-error-sobrenome")
                var labelSobrenome = document.querySelector("#label-sobrenome")
                if (/[@!#$%^&*()/\\0-9]/.test(sobrenome.value)){
                    labelSobrenome.style.color = "red"
                    sobrenome.style.borderColor = "red"
                    sobrenome.style.color = "red"
                    erroSobrenome.textContent = "O sobrenome do aluno não pode conter números ou caracteres especiais."
                    submitButton.disabled = true
                }
                else {
                    labelSobrenome.style.color = "black"
                    sobrenome.style.border = "var(--bs-border-width) solid var(--bs-border-color)"
                    sobrenome.style.borderColor = "black"
                    erroSobrenome.textContent = ""
                    submitButton.disabled = false
                }
            }

            // Validação do campo de email
            function validarEmail(){
                var email = document.querySelector("#email")
                var labelEmail = document.querySelector("#label-email")
                var erroEmail = document.querySelector("#span")

                usuario = email.value.substring(0, email.value.indexOf("@"))
                dominio = email.value.substring(email.value.indexOf("@")+1, email.value.length)

                if ((usuario.length >=1) && (dominio.length >=3) && (usuario.search("@")==-1) &&
                    (dominio.search("@")==-1) && (usuario.search(" ")==-1) && (dominio.search(" ")==-1) &&
                    (dominio.search(".")!=-1) && (dominio.indexOf(".") >=1)&& (dominio.lastIndexOf(".") < dominio.length - 1)) 
                {
                    // email válida
                    email.style.border = "var(--bs-border-width) solid var(--bs-border-color)"
                    labelEmail.style.color = "black"
                    erroEmail.textContent = ""
                }
                else {
                    // email invalido
                    email.style.borderColor = "red"
                    labelEmail.style.color = "red"
                    erroEmail.textContent = "Email Inválido"
                }
            }

            // Validação do campo de senha
            function validarSenha(){
                // VALIDAÇÃO DO CAMPO DE SENHA
                // 1. DEVE CONTER NO MINIMO 8 CARACTERES
                // 2. DEVE CONTER PELO MENOS UM NUMERO
                // 3. DEVE CONTER PELO MENOS UMA LETRA MAIUSCULA
                var senha = document.querySelector("#senha")
                var labelSenha = document.querySelector("#label-senha")
                var erroSenha = document.querySelector("#span-error-senha")
                var msnError = ""               

                // validação
                if (senha.value.length < 8){
                    msnError += "\nO Campo de senha deve conter no minimo 8 caracteres."
                    senha.style.borderColor = "red"
                    labelSenha.style.color = "red"
                }
                else if (!(/[0-9]/.test(senha.value))){
                    msnError += "\nO Campo de senha deve conter pelo menos um numero."
                    senha.style.borderColor = "red"
                    labelSenha.style.color = "red"
                }
                else if (!(/[A-Z]/.test(senha.value))) {
                    msnError += "\nO Campo de senha deve conter pelo menos uma letra maiuscula."
                    senha.style.borderColor = "red"
                    labelSenha.style.color = "red"
                }
                else {
                    msnError = ""
                    senha.style.border = "var(--bs-border-width) solid var(--bs-border-color)"
                    labelSenha.style.color = "black"
                }

                erroSenha.textContent = msnError               

            }
            
            // Validação do campo de confirmação de senha 
            function validarSenhaConfirm() {
                // VALIDAÇÃO DO CAMPO DE CONFIRMAÇÃO DE SENHA                                                                                                                                                  
                var senhaConfirm = document.querySelector("#senha-confirm")
                var senha = document.querySelector("#senha")
                var labelSenhaConfirm = document.querySelector("#label-senha-confirm")
                var erroSenhaConfirm = document.querySelector("#span-error-senha-confirm")

                if (senhaConfirm.value !== senha.value) {
                    erroSenhaConfirm.textContent = "\nAs duas senhas não conferem."
                    senhaConfirm.style.borderColor = "red"
                    labelSenhaConfirm.style.color = "red"
                }
                else {
                    erroSenhaConfirm.textContent = ""
                    senhaConfirm.style.border = "var(--bs-border-width) solid var(--bs-border-color)"
                    labelSenhaConfirm.style.color = "var(--bs-body-color)"
                }
            }

            // Validar datas de inicio e de fim do curso
            function validarData(){
                var ingresso = document.querySelector("#ingresso")
                var conclusao = document.querySelector("#conclusao")

                // Se a data de ingresso for maior do que a data de conclusão, datas invalidas
                var dataIngressoList = ingresso.value.split("-") 
                var dataConclusaoList = conclusao.value.split("-") 

                // Se o ano ou o dia ou o mes da conclusão for maior que o ingresso as datas são válidas
                if (
                    (dataConclusaoList[0] > dataIngressoList[0]) ||
                    (dataConclusaoList[1] > dataIngressoList[1]) ||
                    (dataConclusaoList[2] > dataIngressoList[2])
                    )
                    {
                        // Data válida
                        ingresso.style.border = "var(--bs-border-width) solid var(--bs-border-color)"
                        conclusao.style.border = "var(--bs-border-width) solid var(--bs-border-color)"
                        submitButton.disabled = false
                    }
                else {
                    // data inválida
                    ingresso.style.borderColor = "red"
                    conclusao.style.borderColor = "red"
                    submitButton.disabled = true
                }
            }

            document.querySelector("#nome").addEventListener("keyup", validarNome)
            document.querySelector("#sobrenome").addEventListener("keyup", validarSobrenome)
            document.querySelector("#senha").addEventListener("blur", validarSenha)
            document.querySelector("#senha-confirm").addEventListener("blur", validarSenhaConfirm)
            document.querySelector("#email").addEventListener("blur", validarEmail)
            document.querySelector("#conclusao").addEventListener("blur", validarData)

        </script>
    </div>
</body>
</html>